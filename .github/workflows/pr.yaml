name: pr

on:
  push:
    branches:
      - "pull-request/[0-9]+"

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  SHARED_ACTIONS_REF: empty-certs

jobs:
  telemetry-setup:
    runs-on: ubuntu-latest
    continue-on-error: true
    env:
        OTEL_SERVICE_NAME: "pr-rmm"
        OTEL_EXPORTER_OTLP_ENDPOINT: "https://fb.local.gha-runners.nvidia.com:4318/"
    steps:
      - name: Telemetry setup
        uses: rapidsai/shared-actions/telemetry-dispatch-stash-base-env-vars@main
  conda-cpp-build:
    secrets: inherit
    uses: rapidsai/shared-workflows/.github/workflows/conda-cpp-build.yaml@no-certs
    with:
      build_type: pull-request
      node_type: cpu4-test-west
  telemetry-summarize:
    runs-on: ubuntu-latest
    needs: conda-cpp-build
    if: always()
    continue-on-error: true
    steps:
      - name: Telemetry summarize
        uses: rapidsai/shared-actions/telemetry-dispatch-write-summary@main
